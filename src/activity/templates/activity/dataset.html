{% extends 'base.html' %}
{% load static %}
{% block title %}Neural Activity - Find Neuron{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tom-select/2.4.3/css/tom-select.bootstrap5.min.css"
  integrity="sha512-gKMzEZw+6phm9jAZ9p9x0MdnT2I8U+cv68/UFA0y/RhG4zh2OKSCW4jkjGTzSXvS9oxxKzJD1Om9VD6xKf8y0A=="
  crossorigin="anonymous" referrerpolicy="no-referrer"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.24.2/bootstrap-table.min.css"
    integrity="sha512-ThXPnGXIJOi9huerzcKWpEqyPCaCECA9/Z3Sn5P8T37S2cm57p8Zz8g5r7woyEg+F5u7n5sRYg/LW/pCmpZnDA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{% static 'core/css/tomselect_selector_n.css' %}">
    <link rel="stylesheet" href="{% static 'activity/css/activity_common.css' %}">
<link rel="stylesheet" href="{% static 'activity/css/find_neuron.css' %}">
{% endblock %}

{% block main %}
<div class="container-lg py-3">
    <h4>Datasets</h4>
    <p>Explore, plot, and download datasets.</p>

    <div class="collapse" id="collpaseDataType">
        <div class="card card-body">
            <h5>Dataset Type</h5>
            <div id="datasetTypeLegend"></div>
        </div>
    </div>
    
    <div class="collapse" id="collpaseDataInfo">
        <div class="card card-body mt-3">
            <h5>Data Info</h5>
            <div class="row">
                <div class="col-12 col-md-6">
                    <h6>JSON Info</h6>
                    <p>
                        The datasets are offered in JSON format.
                        JSON is a standard data format, which can be imported in virtually any language.<br>
                        For information about the data structure, please check out the information file below.
                    </p>
                    <div class="btn-group-sm">
                        <a href="https://storage.googleapis.com/www-deploy-bucket/activity/readme_data.md" type="button" class="btn btn-sm btn-primary">JSON Info</a>
                    </div>
                </div>
                <div class="col-12 col-md-6 mt-md-0 mt-3">
                    <h6>Data Repository</h6>
                    <p>
                        To download multiple or all datasets at once, please refer to the data repository info.
                        The repository contains the HDF5 files, which contain all available variables.
                        <br><br>
                    </p>
                    <div class="btn-group-sm">
                        <a href="/about/#data_repo" type="button" class="btn btn-sm btn-primary">Data Repository</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card card-body mt-3">
        <!-- control -->
        <div class="d-flex align-items-center flex-wrap gap-2 mb-3">
            <div class="tom-select-container">
                <input style="width:250px" id="paperSelector" autocomplete="off" type="text"
                    class="form-control form-control-sm" placeholder="Select papers to include">
            </div>
            <div class="tom-select-container">
                <input style="width:300px" id="datasetSelector" autocomplete="off" type="text"
                    class="form-control form-control-sm" placeholder="Filter by dataset types">
            </div>
            <div>
                <input style="width:200px" id="customSearch" class="form-control form-control-sm flex-grow-1" type="text"
                    placeholder="Dataset search" aria-label="Find neuron table search">
            </div>
            <div class="btn-group btn-group-sm">
                <button id="clearSelector" class="btn btn-light" data-bs-toggle="tooltip" data-bs-placement="top"
                    data-bs-title="Clear the dataset type filter">
                    Clear
                </button>
                <button id="downloadSelected" class="btn btn-light" data-bs-toggle="tooltip" data-bs-placement="top"
                    data-bs-title="Download selected">
                    <i class="bi bi-download"></i>
                </button>
            </div>

            <div class="btn-group btn-group-sm">
                <button id="clearSelector" class="btn btn-light" data-bs-toggle="collapse" data-bs-target="#collpaseDataType" aria-expanded="false" aria-controls="collpaseDataType">
                    Dataset Type
                </button>
                <button id="downloadSelected" class="btn btn-light" data-bs-toggle="collapse" data-bs-target="#collpaseDataInfo" aria-expanded="false" aria-controls="collpaseDataInfo">
                    Dataset Info
                </button>
            </div>
        </div>

        <!-- table -->
        <table id="datasetTable" data-pagination="true" data-height="600" data-page-size="25" data-unique-id="id"
            data-search-selector="#customSearch" data-search="true">
            <thead>
                <tr>
                    <th data-checkbox="true"></th>
                    <th data-field="paper" data-sortable="true" data-searchable="false">Paper</th>
                    <th data-field="label" data-sortable="true" data-searchable="true">Dataset</th>
                    <th data-field="n_neuron" data-sortable="true" data-searchable="false">N(recorded)</th>
                    <th data-field="n_labeled" data-sortable="true" data-searchable="false">N(labeled)</th>
                    <th data-field="dataset_type" data-sortable="true" data-searchable="false">Type</th>
                    <th data-field="length" data-sortable="true" data-searchable="false">Length (min)</th>
                    <th data-field="action" data-sortable="false" data-searchable="false"></th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<!-- Embed JSON data using json_script -->
<!-- {{ data|json_script:"data-data" }} -->
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/tom-select/2.4.3/js/tom-select.complete.js"
  integrity="sha512-cv8SyZZkoW3eB3rWs0JsM/wNxKZe59+tMN8ewVIu24I1EAeBOT6lqkdty/iMxo3OJGvrFRYIrrGwM5BJqAXsYw=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
    integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.24.2/bootstrap-table.min.js"
    integrity="sha512-GS/lQJ1AiKWEDCgf1yKepN4m/xewSX6jEVL06KQU6jdAZb3FprSXR2cdBL7FHmo6t5M2gcspMi8I6DqzfPGVew=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.24.2/extensions/mobile/bootstrap-table-mobile.min.js"
    integrity="sha512-5no9dDVV2Fw1ps16Qz2jOdnTkAR56P1i9s2ZtMry5PZt2tqpJ/qnZMgcGBXNYwfOR2y4EvdBfUrC2ZW2YVq2qQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>const data = JSON.parse('{{ datasets|safe }}');</script>
<script>const datasetTypes = JSON.parse('{{ dataset_types|safe }}');</script>
<script>const paperDatasetTypes = JSON.parse('{{ dataset_type_per_paper|safe }}');</script>
<script>const papers = JSON.parse('{{ papers|safe }}');</script>

<script type="module" src="{% static 'core/js/tomselect_plugin.js' %}" defer></script>
<script type="module" src="{% static 'activity/js/views/dataset.js' %}" defer></script>
{% endblock %}