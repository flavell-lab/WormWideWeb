{% extends 'base.html' %}
{% load static %}
{% block title %}WormWideWeb{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/index.css' %}">
{% endblock %}

{% block main %}
<!-- Hero Section -->
<section class="hero-blurred-backdrop">
    <div class="hero-blur"></div>

    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 mt-3 mt-lg-0">
                <h1 class="display-3 fw-bold mb-4">Explore <i>C. elegans</i> Neural Activity and Wiring</h1>
                <p class="lead mb-5">Discover, analyze, and visualize the neural activity and connectivity of <i>C. elegans</i> through our interactive app</p>
                <a href="#explore" class="btn btn-custom btn-lg">Get Started</a>
            </div>
            <div class="col-lg-6 mb-3 mb-lg-0">
                <br>
                <img src="/static/core/img/main-hero.webp" alt="WWW logo" class="img-fluid hero-image">
            </div>
        </div>
    </div>
</section>

<section class="stats-section" id="stats">
    <div class="container">
      <div class="row">
        <!-- Counter 1 -->
        <div class="col-md-2">
          <div class="counter-box">
            <span class="counter" data-target={{n_paper}}>0</span>
            <p>Publications</p>
          </div>
        </div>
        <!-- Counter 2 -->
        <div class="col-md-2">
          <div class="counter-box">
            <span class="counter" data-target={{n_dataset}}>0</span>
            <p>Neural Activity Datasets</p>
          </div>
        </div>
        <!-- Counter 3 -->
        <div class="col-md-2">
          <div class="counter-box">
            <span class="counter" data-target="{{n_neuron}}">0</span>
            <p>Recorded Neurons</p>
          </div>
        </div>
        <!-- Counter 4 -->
        <div class="col-md-3">
          <div class="counter-box">
            <span class="counter" data-target={{n_connectome_dataset}}>0</span>
            <p>Connectome Datasets</p>
          </div>
        </div>
        <!-- Counter 5 -->
        <div class="col-md-3">
          <div class="counter-box">
            <span class="counter" data-target={{n_synapse}}>0</span>
            <p>Synapses</p>
          </div>
        </div>
      </div>
      <div class="row">
        <p class="section-description">
          At your fingertips to explore
        </p>
      </div>
    </div>
  </section>
  

<!-- GCaMP -->
<section class="feature-section" id="explore">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 mb-4 mb-lg-0">
                <img src="{% static 'activity/img/activity-index-hero.webp' %}" alt="Neural activity plot" class="img-fluid feature-image">
            </div>
            <div class="col-lg-6">
                <h2 class="section-title">Neural Activity Data</h2>
                <p class="section-description mb-4">
                    <b>Freely moving whole-brain calcium imaging datasets</b><br>
                    We've collected dozens of freely behaving <i>C. elegans</i> whole-brain datasets. You can easily find the neural (GCaMP) traces of specific neuron classes, along with the info on how those neurons encode behavioral informationâ€”identified by the <i>C. elegans</i> Probabilistic Neural Encoding Model (CePNEM).
                </p>
                <a href="{% url 'activity-index' %}" class="btn btn-custom">Explore</a>
            </div>
        </div>
    </div>
</section>

<!-- Connectome -->
<section class="feature-section">
    <div class="container">
        <div class="row align-items-center flex-lg-row-reverse">
            <div class="col-lg-6 mb-4 mb-lg-0">
                <img src="/static/activity/img/example_encoding_connectome.webp" alt="Encoding feature connectome plot" class="img-fluid feature-image">
            </div>
            <div class="col-lg-6">
                <h2 class="section-title">Encoding</h2>
                <p class="section-description mb-4">
                    Explore how each neuron class encodes various behaviors according to the CePNEM. We use the probabilistic models to explain how each neuron encodes quantitative behavioral features.
                </p>
                <a href="{% url 'encoding-index' %}" class="btn btn-custom">Explore</a>
            </div>
        </div>
    </div>
</section>


<section class="feature-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 mb-4 mb-lg-0">
                <img src="{% static 'connectome/img/screenshot1.webp' %}" alt="Connectome diagram" class="img-fluid feature-image" style="max-width: 450px;">
            </div>
            <div class="col-lg-6">
                <h2 class="section-title">Connectome</h2>
                <p class="section-description mb-4">
                    Discover, analyze, and visualize the complete neural connectivity of <i>C. elegans</i> through our interactive platform.
                </p>
                <a href="{% url 'connectome-index' %}" class="btn btn-custom">Explore</a>
            </div>
        </div>
    </div>
</section>

<!-- <section class="feature-section">
    <div class="container">
        <div class="row align-items-center flex-lg-row-reverse">
            <div class="col-lg-6 mb-4 mb-lg-0">
                <img src="/static/connectome/img/screenshot1.png" alt="Search interface" class="img-fluid feature-image">
            </div>
            <div class="col-lg-6">
                <h2 class="section-title">Advanced Neuron Search</h2>
                <p class="section-description mb-4">
                    Find specific neurons and their connections using our powerful search tool. Filter by type, location, connectivity patterns, and more.
                </p>
                <a href="#" class="btn btn-custom">Search Neurons</a>
            </div>
        </div>
    </div>
</section> -->
{% endblock %}

{% block extra_js %}
<script>
    // Function to animate a single counter
    function animateCounter(counter) {
      const target = +counter.getAttribute('data-target'); // final number
      const duration = 1000; // total animation duration in ms
      const startTime = performance.now();
  
      function updateCount(currentTime) {
        const elapsed = currentTime - startTime;
        // Calculate progress from 0 to 1
        const progress = Math.min(elapsed / duration, 1);
        // Ease out or linear (optional)
        const easedProgress = 1 - Math.pow(1 - progress, 3);
  
        // Current value
        const currentValue = Math.floor(easedProgress * target);
  
        // Update the counter display
        counter.innerText = currentValue;
  
        // Continue animating if not reached target
        if (progress < 1) {
          requestAnimationFrame(updateCount);
        } else {
          // Ensure final value is set
          counter.innerText = target;
        }
      }
  
      requestAnimationFrame(updateCount);
    }
  
    // Intersection Observer to trigger animation on scroll
    const counters = document.querySelectorAll('.counter');
    const observerOptions = {
      root: null,       // viewport
      threshold: 0.1    // trigger when 10% of the element is visible
    };
  
    const counterObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          animateCounter(entry.target);
          // Stop observing once animated
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);
  
    counters.forEach(counter => {
      counterObserver.observe(counter);
    });
  </script>
  
{% endblock %}